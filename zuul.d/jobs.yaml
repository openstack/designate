- job:
    name: designate-grenade-common
    parent: grenade
    required-projects:
      - opendev.org/openstack/horizon
      - opendev.org/openstack/designate
      - opendev.org/openstack/designate-dashboard
      - opendev.org/openstack/designate-tempest-plugin
      - opendev.org/openstack/python-designateclient
    vars:
      devstack_plugins:
        designate: https://opendev.org/openstack/designate
      devstack_services:
        designate: true
        designate-api: true
        designate-central: true
        designate-producer: true
        designate-worker: true
        designate-mdns: true
        designate-agent: true
        designate-sink: true
        horizon: true
        s-account: false
        s-container: false
        s-object: false
        s-proxy: false
        c-bak: false
        neutron-dns: true
        q-svc: false
        neutron-api: true
        neutron-ovn-maintenance-worker: true
        neutron-rpc-server: false
        neutron-periodic-workers: true
      grenade_localrc:
        BASE_RUN_SMOKE: False
      grenade_devstack_localrc:
        shared:
          Q_AGENT: ovn
          Q_ML2_PLUGIN_MECHANISM_DRIVERS: ovn
          NEUTRON_DEPLOY_MOD_WSGI: True
      tox_envlist: all
      tempest_plugins:
        - designate-tempest-plugin
      tempest_test_regex: designate_tempest_plugin(?!\.tests.api.v1).*
    irrelevant-files:
      - ^.*\.rst$
      - ^api-ref/.*$
      - ^doc/.*$
      - ^releasenotes/.*$

- job:
    name: designate-grenade-skip-level-common
    parent: designate-grenade-common
    vars:
        # Move this forward when master changes to a new skip-level-allowed
        # target release. Right now, this is Dalmatian (2024.2) because master is
        # Flamingo (2025.2).
        # When master is G (2026.1), this should become Epoxy (2025.1),
        # and so forth.
        grenade_from_branch: stable/2024.2
        grenade_localrc:
          NOVA_ENABLE_UPGRADE_WORKAROUND: True

- job:
    name: designate-grenade-pdns4
    parent: designate-grenade-common
    post-run: playbooks/designate-pdns4/post.yaml
    vars:
      grenade_devstack_localrc:
        shared:
          DESIGNATE_BACKEND_DRIVER: pdns4
          DESIGNATE_SERVICE_PORT_DNS: 5322

- job:
    name: designate-grenade-bind9
    parent: designate-grenade-common
    post-run: playbooks/designate-bind9/post.yaml

- job:
    name: designate-grenade-pdns4-skip-level
    parent: designate-grenade-skip-level-common
    post-run: playbooks/designate-pdns4/post.yaml
    vars:
      grenade_devstack_localrc:
        shared:
          DESIGNATE_BACKEND_DRIVER: pdns4
          DESIGNATE_SERVICE_PORT_DNS: 5322

- job:
    name: designate-grenade-bind9-skip-level
    parent: designate-grenade-skip-level-common
    post-run: playbooks/designate-bind9/post.yaml

- job:
    name: designate-tox-dnspython-latest
    parent: openstack-tox
    description: |
      Run the Designate unit tests with the latest release of dnspython.
    irrelevant-files: &base_irrelevant_files
      - ^.*\.rst$
      - ^api-ref/.*$
      - ^doc/.*$
      - ^releasenotes/.*$
    vars:
      tox_envlist: dnspython-latest
